<?xml version="1.0"?>
<robot name="control_moment_gyroscope" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:macro name="cmg" params = "parent *origin">

        <xacro:property name="flywheel_mass" value="4.0"/>
        <xacro:property name="flywheel_Ixx" value="0.005950"/>
        <xacro:property name="flywheel_Ixy" value="0.0"/>
        <xacro:property name="flywheel_Ixz" value="0.0"/>
        <xacro:property name="flywheel_Iyy" value="0.011299999"/>
        <xacro:property name="flywheel_Iyz" value="0.0"/>
        <xacro:property name="flywheel_Izz" value="0.005950"/>

        <xacro:property name="gimbal_mass" value="1"/>
        <xacro:property name="gimbal_Ixx" value="0.003773117"/>
        <xacro:property name="gimbal_Ixy" value="0.0"/>
        <xacro:property name="gimbal_Ixz" value="0.0"/>
        <xacro:property name="gimbal_Iyy" value="0.00061837"/>
        <xacro:property name="gimbal_Iyz" value="0.0"/>
        <xacro:property name="gimbal_Izz" value="0.003989672"/>


     
        <link name="frame">
            <visual>
                <origin xyz="0.0 0 1.114642" rpy="0 0.0 0"/> <!--xyz="0.0 0.0 0.0" rpy="0 0.0 0" -->
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/cmg_link.STL" scale="0.001 0.001 0.001"/>         
                </geometry>
                <material name="light grey"/>
            </visual>

            <collision>
                <origin xyz="0 0 0" rpy="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/cmg_link.STL" scale="0.001 0.001 0.001"/>
                </geometry>
            </collision>

            <inertial>
                <mass value="2.84" /> <!--20.781-->
                <origin xyz="0 0.200550054 0" rpy="0 0.0 0"/>
                <inertia ixx="0.069831822" ixy="0.000002709"  ixz="0.001167158"  iyy="0.062838135"  iyz="0.000012214"  izz="0.037865996" />
            </inertial>
        </link>

<!-- ######################################################################################### -->

        <joint name="hip_joint" type="revolute">
            <parent link="frame"/>
            <child link="hip_link"/>
            <axis xyz="1 0 0"/>
            <limit effort="100" velocity="1000"/>
            <joint_properties damping="1.0" friction="1.0"/>
            <xacro:insert_block name="origin" />            
        </joint>

        <link name="hip_link">
            <visual>
                <origin xyz="-0.042455 0 0" rpy="3.14 0 0"/> 
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/hip_link.STL" scale="0.001 0.001 0.001"/>         
                </geometry>
                <material name="light grey"/>
            </visual>

            <collision>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <!-- <box size = "  0.127 0.168778 0.958442 "/>                     -->
                    <mesh filename="package://cmg_robot_description/meshes/hip_link.STL" scale="0.001 0.001 0.001"/>
                </geometry>
            </collision>

            <inertial>
                <mass value="3.325" /> 
                <origin xyz="0 0 0" rpy="0.0 0.0 0"/>
                <inertia ixx="0.006208194" ixy="0.000396490"  ixz="-0.000685512"  iyy="0.006554912"  iyz="-0.000658520" izz="0.006773627" />
            </inertial>
        </link>

<!-- ######################################################################################### -->

        <joint name="Left_gimbal_joint" type="revolute">
            <!-- <origin xyz="-0.000001 0.08 -0.0015" rpy="0 0 1.57"/> -->
            <origin xyz="0 0.221 -0.08" rpy="0 0 0"/>
            <axis xyz="0 1 0" />
            <parent link="frame"/>
            <child link="Left_gimbal"/>            
            <limit effort="100" velocity="100" upper="0.785" lower="-0.785"/>
            <!-- <calibration falling="1.0"/> -->
            <joint_properties damping="1.0" friction="1.0"/>
        </joint>

<!-- ######################################################################################### -->

        <link name="Left_gimbal">
            <visual>
                <origin xyz="0.0 0.0 0.0" rpy="0 0.0 0"/> 
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/left_gimbal_link.STL" scale="0.001 0.001 0.001"/>         
                </geometry>
                <material name="dark grey"/>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/left_gimbal_link.STL" scale="0.001 0.001 0.001"/>        
                </geometry>
            </collision>
            <inertial>
                <mass value="${gimbal_mass}" />
                <origin xyz="0 0 0" />
                <inertia ixx="${gimbal_Ixx}" ixy="${gimbal_Ixy}" ixz="${gimbal_Ixz}" iyy="${gimbal_Iyy}" iyz="${gimbal_Iyz}" izz="${gimbal_Izz}"/>
            </inertial>
        </link>

<!-- ######################################################################################### -->

        <joint name="Left_flywheel_joint" type="continuous">
            <origin xyz="0 0 0" rpy="-1.57 0 0"/>
            <axis xyz="0 1 0" />
            <parent link="Left_gimbal"/>
            <child link="Left_flywheel"/>
            <limit effort="100" velocity="1000"/>
            <joint_properties damping="0.0" friction="0.0"/>
        </joint>

<!-- ######################################################################################### -->

        <link name="Left_flywheel">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/left_flywheel_link.STL" scale="0.001 0.001 0.001" />
                </geometry>
                <material name="white"/>
            </visual>

            <collision>
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/left_flywheel_link.STL" scale="0.001 0.001 0.001" />
                </geometry>
            </collision>

            <inertial>
                <mass value="${flywheel_mass}" />
                <origin xyz="0 0 0" />
                <inertia ixx="${flywheel_Ixx}" ixy="${flywheel_Ixy}" ixz="${flywheel_Ixz}" iyy="${flywheel_Iyy}" iyz="${flywheel_Iyz}" izz="${flywheel_Izz}"/>
            </inertial>
        </link>

<!-- ######################################################################################### -->

        <joint name="Right_gimbal_joint" type="revolute">            
            <origin xyz="0 0.221 0.08" rpy="0 0 0"/>
            <axis xyz="0 1 0" />
            <parent link="frame"/>
            <child link="Right_gimbal"/>            
            <limit effort="100" velocity="100" upper="0.785" lower="-0.785"/>
            <joint_properties damping="1.0" friction="1.0"/>
        </joint>

<!-- ######################################################################################### -->

        <link name="Right_gimbal">
            <visual>
                <origin xyz="0.0 0.0 0.0" rpy="0 0.0 0"/> 
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/right_gimbal_link.STL" scale="0.001 0.001 0.001"/>         
                </geometry>
                <material name="dark grey"/>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0.0 0.0 0.0"/>
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/right_gimbal_link.STL" scale="0.001 0.001 0.001"/>        
                </geometry>
            </collision>
            <inertial>
                <mass value="${gimbal_mass}" />
                <origin xyz="0 0 0" />
                <inertia ixx="${gimbal_Ixx}" ixy="${gimbal_Ixy}" ixz="${gimbal_Ixz}" iyy="${gimbal_Iyy}" iyz="${gimbal_Iyz}" izz="${gimbal_Izz}"/>
            </inertial>
        </link>

<!-- ######################################################################################### -->

        <joint name="Right_flywheel_joint" type="continuous">
            <origin xyz="0 0 0" rpy="-1.57 0 0"/>
            <axis xyz="0 1 0" />
            <parent link="Right_gimbal"/>
            <child link="Right_flywheel"/>
            <limit effort="100" velocity="1000"/>
            <joint_properties damping="0.0" friction="0.0"/>
        </joint>

<!-- ######################################################################################### -->

        <link name="Right_flywheel">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/right_flywheel_link.STL" scale="0.001 0.001 0.001" />
                </geometry>
                <material name="white"/>
            </visual>

            <collision>
                <geometry>
                    <mesh filename="package://cmg_robot_description/meshes/right_flywheel_link.STL" scale="0.001 0.001 0.001" />
                </geometry>
            </collision>

            <inertial>
                <mass value="${flywheel_mass}" />
                <origin xyz="0 0 0" />
                <inertia ixx="${flywheel_Ixx}" ixy="${flywheel_Ixy}" ixz="${flywheel_Ixz}" iyy="${flywheel_Iyy}" iyz="${flywheel_Iyz}" izz="${flywheel_Izz}"/>
            </inertial>
        </link>

<!-- ######################################################################################### -->

        <gazebo reference="Right_gimbal">
            <mu1>1.0</mu1>
            <mu2>1.0</mu2> 
            <kp>1e+13</kp>
            <kd>1.0</kd>
            <maxVel>0.001</maxVel>
            <minDepth>0.00000000001</minDepth>
            <turnGravityOff>false</turnGravityOff>
            <gravity>1</gravity>
            <material>Gazebo/DarkGrey</material>
        </gazebo>

        <gazebo reference="Left_gimbal">
            <mu1>1.0</mu1>
            <mu2>1.0</mu2> 
            <kp>1e+13</kp>
            <kd>1.0</kd>
            <maxVel>0.001</maxVel>
            <minDepth>0.00000000001</minDepth>
            <turnGravityOff>false</turnGravityOff>
            <gravity>1</gravity>
            <material>Gazebo/DarkGrey</material>
        </gazebo>

        <gazebo reference="frame">
            <mu1>1.0</mu1>
            <mu2>1.0</mu2> 
            <kp>1e+13</kp>
            <kd>1.0</kd>
            <maxVel>0.001</maxVel>
            <minDepth>0.00000000001</minDepth>
            <turnGravityOff>false</turnGravityOff>
            <gravity>1</gravity>
            <material>Gazebo/Grey</material>
        </gazebo>
       	
        <gazebo reference="Right_flywheel">
            <mu1>1.0</mu1>
            <mu2>1.0</mu2> 
            <kp>1e+13</kp>
            <kd>1.0</kd>
            <maxVel>0.001</maxVel>
            <minDepth>0.00000000001</minDepth>
            <turnGravityOff>false</turnGravityOff>
            <gravity>1</gravity>
            <material>Gazebo/White</material>
        </gazebo>

        <gazebo reference="Left_flywheel">
            <mu1>1.0</mu1>
            <mu2>1.0</mu2> 
            <kp>1e+13</kp>
            <kd>1.0</kd>
            <maxVel>0.001</maxVel>
            <minDepth>0.00000000001</minDepth>
            <turnGravityOff>false</turnGravityOff>
            <gravity>1</gravity>
            <material>Gazebo/White</material>
        </gazebo>

        <gazebo reference="hip_link">
            <mu1>1.0</mu1>
            <mu2>1.0</mu2> 
            <kp>1e+13</kp>
            <kd>1.0</kd>
            <maxVel>0.001</maxVel>
            <minDepth>0.00000000001</minDepth>
            <turnGravityOff>false</turnGravityOff>
            <gravity>1</gravity>
            <material>Gazebo/White</material>
        </gazebo>

                <!-- <imu>
                    <angular_velocity>
                        <x>
                            <noise type="gaussian">
                                <mean>0.0</mean>
                                <stddev>2e-4</stddev>
                                <bias_mean>0.0000075</bias_mean>
                                <bias_stddev>0.0000008</bias_stddev>
                            </noise>
                        </x>
                        <y>
                            <noise type="gaussian">
                                <mean>0.0</mean>
                                <stddev>2e-4</stddev>
                                <bias_mean>0.0000075</bias_mean>
                                <bias_stddev>0.0000008</bias_stddev>
                            </noise>
                        </y>
                        <z>
                            <noise type="gaussian">
                                <mean>0.0</mean>
                                <stddev>2e-4</stddev>
                                <bias_mean>0.0000075</bias_mean>
                                <bias_stddev>0.0000008</bias_stddev>
                            </noise>
                        </z>
                    </angular_velocity>
                    <linear_acceleration>
                        <x>
                            <noise type="gaussian">
                                <mean>0.0</mean>
                                <stddev>1.7e-2</stddev>
                                <bias_mean>0.0000075</bias_mean>
                                <bias_stddev>0.0000008</bias_stddev>
                            </noise>
                        </x>
                        <y>
                            <noise type="gaussian">
                                <mean>0.0</mean>
                                <stddev>1.7e-2</stddev>
                                <bias_mean>0.0000075</bias_mean>
                                <bias_stddev>0.0000008</bias_stddev>
                            </noise>
                        </y>
                        <z>
                            <noise type="gaussian">
                                <mean>0.0</mean>
                                <stddev>1.7e-2</stddev>
                                <bias_mean>0.0000075</bias_mean>
                                <bias_stddev>0.0000008</bias_stddev>
                            </noise>
                        </z>
                    </linear_acceleration>
                </imu>                 -->
                <!-- ######################################################################################### -->


        
  	</xacro:macro>	
</robot>


        <!-- <joint name="imu_joint" type="fixed">
            <origin xyz="-0.000001 0.08 -0.0015" rpy="0 0 1.57"ss/>
            <origin xyz="0 0.123 0" rpy="-1.57 0 0"/>
            <parent link="frame"/>
            <child link="imu_link"/>            
        </joint>

        <link name="imu_link">
            <visual>
                <origin xyz="0.0 0.0 0.0" rpy="0 0.0 0"/> xyz="0.0 0.0 0.0" rpy="0 0.0 0"
                <geometry>
                    <box size="0.01 0.01 0.01"/>
                </geometry>
                <material name="dark grey"/>
            </visual>

            <collision>
                <origin xyz="0 0 0" rpy="0.0 0.0 0.0"/>
                <geometry>
                    <box size="0.01 0.01 0.01"/>
                </geometry>
            </collision>
        </link>
        <gazebo reference="imu_link">
            <gravity>true</gravity>
            <sensor name="imu_sensor" type="imu">
                <always_on>true</always_on>
                <update_rate>1000</update_rate>
                <visualize>true</visualize>
                <topic>__default_topic__</topic>
                <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">
                    <topicName>imu</topicName>
                    <bodyName>imu_link</bodyName>
                    <updateRateHZ>100.0</updateRateHZ>
                    <gaussianNoise>0.0</gaussianNoise>
                    <xyzOffset>0 0 0</xyzOffset>
                    <rpyOffset>0 0 0</rpyOffset>
                    <frameName>imu_link</frameName>
                    <initialOrientationAsReference>false</initialOrientationAsReference>
                </plugin>
                <pose>0 0 0 0 0 0</pose>
            </sensor>
        </gazebo> -->